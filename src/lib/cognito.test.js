import {
  ID_TOKEN,
  ACCESS_TOKEN,
  COGNITO,
  signIn,
  toUser,
  parseURL,
  signOut,
  getAccessToken
} from './cognito';

class MyStorage {
  constructor() {}
  setItem = (k, v) => {
    // Object.defineProperty(this, k, { value: v, writable: true });
    this[k] = v;
    console.log(`this.${k} set to ${this[k]}`);
  };
  getItem = k => this[k];
}

test('...', () => {
  const myStorage = new MyStorage();
  myStorage.setItem('abc', 'def');
  console.log(myStorage.abc);
  console.log(myStorage.getItem('abc'));
});

const hashWithTokens =
  '#id_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9' +
  '.eyJhdF9oYXNoIjoiaTNQUVJrVHRQQ3Zyejl4eGo3dVZtQSIsInN1YiI6Ijk5NDA2N2NmLTk5ZDEtNDRkOS1iNTY2LTI0OWRiMjE2YzQzOSIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJpc3MiOiJodHRwczovL2NvZ25pdG8taWRwLnVzLWVhc3QtMS5hbWF6b25hd3MuY29tL3VzLWVhc3QtMV9Zbjg5eUtpem4iLCJjb2duaXRvOnVzZXJuYW1lIjoiOTk0MDY3Y2YtOTlkMS00NGQ5LWI1NjYtMjQ5ZGIyMTZjNDM5IiwiYXVkIjoiNmt0dDBtdHBrczAzcjhzZnRpY2MzaDFvNiIsImV2ZW50X2lkIjoiNGEwZDJhODQtYjE2NS0xMWU4LWE3NTktMGQ4ZmM4YzI5ZTBlIiwidG9rZW5fdXNlIjoiaWQiLCJhdXRoX3RpbWUiOjE1MzYxOTA5MjIsIm5pY2tuYW1lIjoiSGFzaCIsImV4cCI6MTU0Mjg5ODEwMSwiaWF0IjoxNTM2MTkwOTIyLCJlbWFpbCI6Imhhc2hAZXhhbXBsZS5jb20iLCJqdGkiOiIwMzEyNjI0MS1lNGE2LTQ1OTEtOThkYS05MzZjOGQ3NGRiMDUifQ' +
  '.ZVIobZ1aC-hwGOAUSAEqPmAmBD-hz-WJumyKUFb_TCU' +
  '&access_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9' +
  '.eyJzdWIiOiI5OTQwNjdjZi05OWQxLTQ0ZDktYjU2Ni0yNDlkYjIxNmM0MzkiLCJldmVudF9pZCI6IjRhMGQyYTg0LWIxNjUtMTFlOC1hNzU5LTBkOGZjOGMyOWUwZSIsInRva2VuX3VzZSI6ImFjY2VzcyIsInNjb3BlIjoiYXdzLmNvZ25pdG8uc2lnbmluLnVzZXIuYWRtaW4gb3BlbmlkIHByb2ZpbGUgZW1haWwiLCJhdXRoX3RpbWUiOjE1MzYxOTA5MjIsImlzcyI6Imh0dHBzOi8vY29nbml0by1pZHAudXMtZWFzdC0xLmFtYXpvbmF3cy5jb20vdXMtZWFzdC0xX1luODl5S2l6biIsImV4cCI6MTU0Mjg5OTAwNSwiaWF0IjoxNTM2MTkwOTIyLCJ2ZXJzaW9uIjoyLCJqdGkiOiI3YTMxMTUwZS1lYmQ0LTQ3NmEtOTBkNi03ZjQ0NDM4Y2EzZjgiLCJjbGllbnRfaWQiOiJoYXNoOG50cGtzMDNyOHNmdGljYzNoMW82IiwidXNlcm5hbWUiOiI5OTQwNjdjZi05OWQxLTQ0ZDktYjU2Ni0yNDlkYjIxNmM0MzkifQ' +
  '.0wBmYZ20RC5Oi2I7a6lNh0VI6ahzJhTS6v36nu25Q6E' +
  '&expires_in=3600' +
  '&token_type=Bearer';
const parsedHashWithTokens = {
  id_token:
    'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9' +
    '.eyJhdF9oYXNoIjoiaTNQUVJrVHRQQ3Zyejl4eGo3dVZtQSIsInN1YiI6Ijk5NDA2N2NmLTk5ZDEtNDRkOS1iNTY2LTI0OWRiMjE2YzQzOSIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJpc3MiOiJodHRwczovL2NvZ25pdG8taWRwLnVzLWVhc3QtMS5hbWF6b25hd3MuY29tL3VzLWVhc3QtMV9Zbjg5eUtpem4iLCJjb2duaXRvOnVzZXJuYW1lIjoiOTk0MDY3Y2YtOTlkMS00NGQ5LWI1NjYtMjQ5ZGIyMTZjNDM5IiwiYXVkIjoiNmt0dDBtdHBrczAzcjhzZnRpY2MzaDFvNiIsImV2ZW50X2lkIjoiNGEwZDJhODQtYjE2NS0xMWU4LWE3NTktMGQ4ZmM4YzI5ZTBlIiwidG9rZW5fdXNlIjoiaWQiLCJhdXRoX3RpbWUiOjE1MzYxOTA5MjIsIm5pY2tuYW1lIjoiSGFzaCIsImV4cCI6MTU0Mjg5ODEwMSwiaWF0IjoxNTM2MTkwOTIyLCJlbWFpbCI6Imhhc2hAZXhhbXBsZS5jb20iLCJqdGkiOiIwMzEyNjI0MS1lNGE2LTQ1OTEtOThkYS05MzZjOGQ3NGRiMDUifQ' +
    '.ZVIobZ1aC-hwGOAUSAEqPmAmBD-hz-WJumyKUFb_TCU',
  access_token:
    'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9' +
    '.eyJzdWIiOiI5OTQwNjdjZi05OWQxLTQ0ZDktYjU2Ni0yNDlkYjIxNmM0MzkiLCJldmVudF9pZCI6IjRhMGQyYTg0LWIxNjUtMTFlOC1hNzU5LTBkOGZjOGMyOWUwZSIsInRva2VuX3VzZSI6ImFjY2VzcyIsInNjb3BlIjoiYXdzLmNvZ25pdG8uc2lnbmluLnVzZXIuYWRtaW4gb3BlbmlkIHByb2ZpbGUgZW1haWwiLCJhdXRoX3RpbWUiOjE1MzYxOTA5MjIsImlzcyI6Imh0dHBzOi8vY29nbml0by1pZHAudXMtZWFzdC0xLmFtYXpvbmF3cy5jb20vdXMtZWFzdC0xX1luODl5S2l6biIsImV4cCI6MTU0Mjg5OTAwNSwiaWF0IjoxNTM2MTkwOTIyLCJ2ZXJzaW9uIjoyLCJqdGkiOiI3YTMxMTUwZS1lYmQ0LTQ3NmEtOTBkNi03ZjQ0NDM4Y2EzZjgiLCJjbGllbnRfaWQiOiJoYXNoOG50cGtzMDNyOHNmdGljYzNoMW82IiwidXNlcm5hbWUiOiI5OTQwNjdjZi05OWQxLTQ0ZDktYjU2Ni0yNDlkYjIxNmM0MzkifQ' +
    '.0wBmYZ20RC5Oi2I7a6lNh0VI6ahzJhTS6v36nu25Q6E',
  expires_in: '3600',
  token_type: 'Bearer'
};
const searchWithTokens =
  '#id_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9' +
  '.eyJhdF9oYXNoIjoiaTNQUVJrVHRQQ3Zyejl4eGo3dVZtQSIsInN1YiI6Ijk5NDA2N2NmLTk5ZDEtNDRkOS1iNTY2LTI0OWRiMjE2YzQzOSIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJpc3MiOiJodHRwczovL2NvZ25pdG8taWRwLnVzLWVhc3QtMS5hbWF6b25hd3MuY29tL3VzLWVhc3QtMV9Zbjg5eUtpem4iLCJjb2duaXRvOnVzZXJuYW1lIjoiOTk0MDY3Y2YtOTlkMS00NGQ5LWI1NjYtMjQ5ZGIyMTZjNDM5IiwiYXVkIjoiNmt0dDBtdHBrczAzcjhzZnRpY2MzaDFvNiIsImV2ZW50X2lkIjoiNGEwZDJhODQtYjE2NS0xMWU4LWE3NTktMGQ4ZmM4YzI5ZTBlIiwidG9rZW5fdXNlIjoiaWQiLCJhdXRoX3RpbWUiOjE1MzYxOTA5MjIsIm5pY2tuYW1lIjoiU2VhcmNoIiwiZXhwIjoxNTQyODk5NjEwLCJpYXQiOjE1MzYxOTA5MjIsImVtYWlsIjoic2VhcmNoQGV4YW1wbGUuY29tIiwianRpIjoiMDMxMjYyNDEtZTRhNi00NTkxLTk4ZGEtOTM2YzhkNzRkYjA1In0' +
  '.XvRG-2TUiAxG3Cq5q53nQ86XM4lriNSSGu5auC-PX98' +
  '&access_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9' +
  '.eyJzdWIiOiI5OTQwNjdjZi05OWQxLTQ0ZDktYjU2Ni0yNDlkYjIxNmM0MzkiLCJldmVudF9pZCI6IjRhMGQyYTg0LWIxNjUtMTFlOC1hNzU5LTBkOGZjOGMyOWUwZSIsInRva2VuX3VzZSI6ImFjY2VzcyIsInNjb3BlIjoiYXdzLmNvZ25pdG8uc2lnbmluLnVzZXIuYWRtaW4gb3BlbmlkIHByb2ZpbGUgZW1haWwiLCJhdXRoX3RpbWUiOjE1MzYxOTA5MjIsImlzcyI6Imh0dHBzOi8vY29nbml0by1pZHAudXMtZWFzdC0xLmFtYXpvbmF3cy5jb20vdXMtZWFzdC0xX1luODl5S2l6biIsImV4cCI6MTU0MjkwMDA4OSwiaWF0IjoxNTM2MTkwOTIyLCJ2ZXJzaW9uIjoyLCJqdGkiOiI3YTMxMTUwZS1lYmQ0LTQ3NmEtOTBkNi03ZjQ0NDM4Y2EzZjgiLCJjbGllbnRfaWQiOiJzZWFyY2g4bnRwa3MwM3I4c2Z0aWNjM2gxbzYiLCJ1c2VybmFtZSI6Ijk5NDA2N2NmLTk5ZDEtNDRkOS1iNTY2LTI0OWRiMjE2YzQzOSJ9' +
  '.nkmT3eLnr8OyaCHHzY5QIDAzL7-opyNWvylPx9fHO8I' +
  '&expires_in=3600' +
  '&token_type=Bearer';
const parsedSearchWithTokens = {
  id_token:
    'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9' +
    '.eyJhdF9oYXNoIjoiaTNQUVJrVHRQQ3Zyejl4eGo3dVZtQSIsInN1YiI6Ijk5NDA2N2NmLTk5ZDEtNDRkOS1iNTY2LTI0OWRiMjE2YzQzOSIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJpc3MiOiJodHRwczovL2NvZ25pdG8taWRwLnVzLWVhc3QtMS5hbWF6b25hd3MuY29tL3VzLWVhc3QtMV9Zbjg5eUtpem4iLCJjb2duaXRvOnVzZXJuYW1lIjoiOTk0MDY3Y2YtOTlkMS00NGQ5LWI1NjYtMjQ5ZGIyMTZjNDM5IiwiYXVkIjoiNmt0dDBtdHBrczAzcjhzZnRpY2MzaDFvNiIsImV2ZW50X2lkIjoiNGEwZDJhODQtYjE2NS0xMWU4LWE3NTktMGQ4ZmM4YzI5ZTBlIiwidG9rZW5fdXNlIjoiaWQiLCJhdXRoX3RpbWUiOjE1MzYxOTA5MjIsIm5pY2tuYW1lIjoiU2VhcmNoIiwiZXhwIjoxNTQyODk5NjEwLCJpYXQiOjE1MzYxOTA5MjIsImVtYWlsIjoic2VhcmNoQGV4YW1wbGUuY29tIiwianRpIjoiMDMxMjYyNDEtZTRhNi00NTkxLTk4ZGEtOTM2YzhkNzRkYjA1In0' +
    '.XvRG-2TUiAxG3Cq5q53nQ86XM4lriNSSGu5auC-PX98',
  access_token:
    'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9' +
    '.eyJzdWIiOiI5OTQwNjdjZi05OWQxLTQ0ZDktYjU2Ni0yNDlkYjIxNmM0MzkiLCJldmVudF9pZCI6IjRhMGQyYTg0LWIxNjUtMTFlOC1hNzU5LTBkOGZjOGMyOWUwZSIsInRva2VuX3VzZSI6ImFjY2VzcyIsInNjb3BlIjoiYXdzLmNvZ25pdG8uc2lnbmluLnVzZXIuYWRtaW4gb3BlbmlkIHByb2ZpbGUgZW1haWwiLCJhdXRoX3RpbWUiOjE1MzYxOTA5MjIsImlzcyI6Imh0dHBzOi8vY29nbml0by1pZHAudXMtZWFzdC0xLmFtYXpvbmF3cy5jb20vdXMtZWFzdC0xX1luODl5S2l6biIsImV4cCI6MTU0MjkwMDA4OSwiaWF0IjoxNTM2MTkwOTIyLCJ2ZXJzaW9uIjoyLCJqdGkiOiI3YTMxMTUwZS1lYmQ0LTQ3NmEtOTBkNi03ZjQ0NDM4Y2EzZjgiLCJjbGllbnRfaWQiOiJzZWFyY2g4bnRwa3MwM3I4c2Z0aWNjM2gxbzYiLCJ1c2VybmFtZSI6Ijk5NDA2N2NmLTk5ZDEtNDRkOS1iNTY2LTI0OWRiMjE2YzQzOSJ9' +
    '.nkmT3eLnr8OyaCHHzY5QIDAzL7-opyNWvylPx9fHO8I',
  expires_in: '3600',
  token_type: 'Bearer'
};
const urlWithHashWithTokens = {
  hash: hashWithTokens
};
const urlWithSearchWithTokens = {
  search: searchWithTokens
};
const urlWithSearchAndHashWithTokens = {
  hash: hashWithTokens,
  search: searchWithTokens
};

describe('signIn', () => {
  test('a url with tokens should resolve to a signed-in user', () => {
    const url = {
      hash:
        '#id_token=eyJraWQiOiJvUnFkdDJndHg4YnJFOXBZN3JkRUpqdlVqa1M4b0N6RnhzTHQ3NGFKcXlVPSIsImFsZyI6IlJTMjU2In0.eyJhdF9oYXNoIjoiaTNQUVJrVHRQQ3Zyejl4eGo3dVZtQSIsInN1YiI6Ijk5NDA2N2NmLTk5ZDEtNDRkOS1iNTY2LTI0OWRiMjE2YzQzOSIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJpc3MiOiJodHRwczpcL1wvY29nbml0by1pZHAudXMtZWFzdC0xLmFtYXpvbmF3cy5jb21cL3VzLWVhc3QtMV9Zbjg5eUtpem4iLCJjb2duaXRvOnVzZXJuYW1lIjoiOTk0MDY3Y2YtOTlkMS00NGQ5LWI1NjYtMjQ5ZGIyMTZjNDM5IiwiYXVkIjoiNmt0dDBtdHBrczAzcjhzZnRpY2MzaDFvNiIsImV2ZW50X2lkIjoiNGEwZDJhODQtYjE2NS0xMWU4LWE3NTktMGQ4ZmM4YzI5ZTBlIiwidG9rZW5fdXNlIjoiaWQiLCJhdXRoX3RpbWUiOjE1MzYxOTA5MjIsIm5pY2tuYW1lIjoiRG91ZyBGZWQiLCJleHAiOjE1MzYxOTQ1MjIsImlhdCI6MTUzNjE5MDkyMiwiZW1haWwiOiJkb3VnbGFzbmFwaGFzQGdtYWlsLmNvbSJ9.U1b0GyCF1Zzs2GbFKYrKnSC4QvhDhaGkUs0KO9EbnurBS6ThBxnWV9rolJIuxwEiUmRwPflgxPbIChjMDKotptqblh8HT14WgyNQZwmPkz9_efLq-loT6BOIujhNYXm0m6IeZpxEIzlbpSS3pIcnsbjKEElwQb6rASzBuI1TgqxHoWHK58hodZ2XRDcKKZjqYCnYIIy4FTnoK9GRVTPSwHzGnGSW3yDWVAN9VpLkt0G38s8rkLVmw_WdZo95DkgIdp51AfTG33Ha7A7cjzv8vSMl66XgEq02bV70EysO_8uMlohVNhFvui0xOAJmPbZYgn9TzHvQO6n5wEz3rRSeRQ&access_token=eyJraWQiOiJ1VHJ5ajVPTEVjVG16K2pSV3liWGZINTVJQmdLaTlocmt5YzVTNm9FVTNBPSIsImFsZyI6IlJTMjU2In0.eyJzdWIiOiI5OTQwNjdjZi05OWQxLTQ0ZDktYjU2Ni0yNDlkYjIxNmM0MzkiLCJldmVudF9pZCI6IjRhMGQyYTg0LWIxNjUtMTFlOC1hNzU5LTBkOGZjOGMyOWUwZSIsInRva2VuX3VzZSI6ImFjY2VzcyIsInNjb3BlIjoiYXdzLmNvZ25pdG8uc2lnbmluLnVzZXIuYWRtaW4gb3BlbmlkIHByb2ZpbGUgZW1haWwiLCJhdXRoX3RpbWUiOjE1MzYxOTA5MjIsImlzcyI6Imh0dHBzOlwvXC9jb2duaXRvLWlkcC51cy1lYXN0LTEuYW1hem9uYXdzLmNvbVwvdXMtZWFzdC0xX1luODl5S2l6biIsImV4cCI6MTUzNjE5NDUyMiwiaWF0IjoxNTM2MTkwOTIyLCJ2ZXJzaW9uIjoyLCJqdGkiOiI3YTMxMTUwZS1lYmQ0LTQ3NmEtOTBkNi03ZjQ0NDM4Y2EzZjgiLCJjbGllbnRfaWQiOiI2a3R0MG10cGtzMDNyOHNmdGljYzNoMW82IiwidXNlcm5hbWUiOiI5OTQwNjdjZi05OWQxLTQ0ZDktYjU2Ni0yNDlkYjIxNmM0MzkifQ.Z2v6gWVBqwgBrkm8teDKrgrjjj2ArtDe_DAxSI5XrfQJaczD-gLRixThQ-JVn4_CDpuh3OGfZJONdxAduUOrLUBoO5E_gA5vZwoVyxAL7-MauNKjD8hAB237GvtFDm75o43ymo-4C3f7l3dpKZsrP-gdoDe9S_SjL8GSsuCwqNWRedi4l7v1zubFe2Rwy7ivhuK_A_ifvp-Dohj4IWPaI917aFEn5QdWBxe9Jupn2NQhauVVNEsTWE0x8ejUv_YRX1zdiQUfpPdEUYlvZ5xQVrvK4NoGv-eKoKfVL6PyIaTi_QfO29w_PW9_h4V_1g4BUbaO3q4HxB93Zh1d9c0pSA&expires_in=3600&token_type=Bearer'
    };
    const storage = {};
    const expectedUser = {};
  });
});

describe('parseURL', () => {
  test('parseURL on a URL with only search', () => {
    expect(parseURL(urlWithSearchWithTokens)).toEqual(parsedSearchWithTokens);
  });
  test('parseURL on a URL with only hash', () => {
    expect(parseURL(urlWithHashWithTokens)).toEqual(parsedHashWithTokens);
  });
  test('parseURL on a URL with search and hash, should take search', () => {
    expect(parseURL(urlWithSearchAndHashWithTokens)).toEqual(
      parsedSearchWithTokens
    );
  });
  test('parseURL no search no hash', () => {
    expect(
      parseURL({ notSearch: 'no search', hashNot: 'no hash' })
    ).toBeUndefined();
  });
});

describe('toUser', () => {});
